<div class="conge-management-container">
  <div class="header">
    <h1 class="title">🗂️ Gestion des demandes de congés</h1>
    <p class="subtitle">Tableau de bord administratif des demandes de congés</p>
  </div>

  <div class="stats-row">
    <div class="stat-card">
      <span class="stat-label">⏳ En attente</span>
      <span class="stat-value">{{ stats.pending }}</span>
    </div>
    <div class="stat-card">
      <span class="stat-label">✅ Acceptées</span>
      <span class="stat-value">{{ stats.approved }}</span>
    </div>
    <div class="stat-card">
      <span class="stat-label">❌ Refusées</span>
      <span class="stat-value">{{ stats.refused }}</span>
    </div>
  </div>

  <div class="filters-row">
    <label for="statusFilter" class="form-label">🔎 Statut :</label>
    <select id="statusFilter" [(ngModel)]="selectedStatus" (ngModelChange)="filterDemandes()" class="form-control">
      <option value="TOUS">Tous</option>
      <option *ngFor="let status of statusOptions" [value]="status">{{ formatStatus(status) }}</option>
    </select>
  </div>

  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>👤 Demandeur</th>
          <th>🗓️ Période</th>
          <th>📅 Durée</th>
          
          <th>🚦 Statut</th>
          <th>🛠 Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let demande of (filteredDemandes$ | async)">
          <td>{{ demande.worker.name || 'N/A' }}</td>
          <td>{{ demande.startDate }} - {{ demande.endDate }}</td>
          <td>{{ calculateDuration(demande.startDate, demande.endDate) }} jours</td>
          
          <td>
            <span class="status-badge" [ngClass]="'status-' + demande.status.toLowerCase()">
              {{ formatStatus(demande.status) }}
            </span>
          </td>
          <td>
            <div class="action-buttons" *ngIf="demande.status.startsWith('EN_ATTENTE')">
              <button class="btn btn-approve" (click)="handleApproval(demande, true)">✔</button>
              <button class="btn btn-refuse" (click)="handleApproval(demande, false)">✖</button>
            </div>
            <button class="btn btn-view" (click)="viewWorkerDetails(demande.worker)">👁</button>
          </td>
        </tr>
        <tr *ngIf="(filteredDemandes$ | async)?.length === 0">
          <td colspan="5" class="text-center">Aucune demande à afficher.</td>
        </tr>
      </tbody>
    </table>

<app-confirmation-modal
  [isVisible]="isConfirmationModalVisible"
  [title]="modalConfig.title"
  [message]="modalConfig.message"
  [showComment]="modalConfig.showComment"
  [confirmButtonText]="modalConfig.confirmButtonText"
  [cancelButtonText]="modalConfig.cancelButtonText"
  (confirmed)="onModalConfirm($event)"
  (closed)="onModalClose()"
></app-confirmation-modal>

  </div>
</div>

<app-worker-details-modal 
  *ngIf="isModalVisible" 
  [worker]="selectedWorker" 
  (close)="closeModal()">
</app-worker-details-modal>

<div class="conge-management-container">
  <div class="header">
    <h1 class="title">Demandes de congés</h1>
  </div>

  <div class="stats-row">
    <div class="stat-card">
      <span class="stat-label">⏳ En attente</span>
      <span class="stat-value">{{ stats.pending }}</span>
    </div>
    <div class="stat-card">
      <span class="stat-label">✅ Acceptées</span>
      <span class="stat-value">{{ stats.approved }}</span>
    </div>
    <div class="stat-card">
      <span class="stat-label">❌ Refusées</span>
      <span class="stat-value">{{ stats.refused }}</span>
    </div>
  </div>

  <div class="filters-row">
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>🔎 Filtrer par statut</mat-label>
      <mat-select [(ngModel)]="selectedStatus" (selectionChange)="filterDemandes()">
        <mat-option value="TOUS">Tous</mat-option>
        <mat-option *ngFor="let status of statusOptions" [value]="status">
          {{ formatStatus(status) }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Rechercher par nom</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Ahmed" #input>
    </mat-form-field>
  </div>

  <div class="table-container mat-elevation-z8">
    <table mat-table [dataSource]="dataSource" matSort>

      <!-- Worker Name Column -->
      <ng-container matColumnDef="workerName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>👤 Demandeur</th>
        <td mat-cell *matCellDef="let row">{{ row.worker?.name }}</td>
      </ng-container>

      <!-- Period Column -->
      <ng-container matColumnDef="period">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>📅 Période</th>
        <td mat-cell *matCellDef="let row">{{ row.startDate | date: 'dd/MM/yyyy' }} - {{ row.endDate | date: 'dd/MM/yyyy' }}</td>
      </ng-container>

      <!-- Duration Column -->
      <ng-container matColumnDef="duration">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>⏳ Durée</th>
        <td mat-cell *matCellDef="let row">{{ calculateDuration(row.startDate, row.endDate) }} jours</td>
      </ng-container>

      <!-- Type Column -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>📄 Type</th>
        <td mat-cell *matCellDef="let row">{{ row.type }}</td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>🚦 Statut</th>
        <td mat-cell *matCellDef="let row">
          <span class="status-badge" [ngClass]="'status-' + row.status.toLowerCase()">
            {{ formatStatus(row.status) }}
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>🛠 Actions</th>
        <td mat-cell *matCellDef="let row">
          <div class="action-buttons">
            <button class="btn btn-approve" *ngIf="canApprove(row.status)" (click)="handleApproval(row, true)">✔</button>
            <button class="btn btn-refuse" *ngIf="canApprove(row.status)" (click)="handleApproval(row, false)">✖</button>
            <button class="btn btn-view" (click)="viewWorkerDetails(row.worker)">👁</button>
            <button class="btn btn-download" *ngIf="row.attachmentPath" (click)="downloadAttachment(row.attachmentPath)">📥</button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="6">Aucune donnée correspondant au filtre "{{input.value}}"</td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons></mat-paginator>
  </div>

<app-confirmation-modal
  [isVisible]="isConfirmationModalVisible"
  [title]="modalConfig.title"
  [message]="modalConfig.message"
  [showComment]="modalConfig.showComment"
  [confirmButtonText]="modalConfig.confirmButtonText"
  [cancelButtonText]="modalConfig.cancelButtonText"
  (confirmed)="onModalConfirm($event)"
  (closed)="onModalClose()"
></app-confirmation-modal>

</div>

<app-worker-details-modal 
  *ngIf="isModalVisible" 
  [worker]="selectedWorker" 
  (close)="closeModal()">
</app-worker-details-modal>
